<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>test result</title>
    <meta name="generator" content="HTMLTestRunner 0.8.2"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <style type="text/css" media="screen">
        body {
            font-family: verdana, arial, helvetica, sans-serif;
            font-size: 80%;
        }

        table {
            font-size: 100%;
        }

        pre {
        }

        /* -- heading ---------------------------------------------------------------------- */
        h1 {
            font-size: 16pt;
            color: gray;
        }

        .heading {
            margin-top: 0ex;
            margin-bottom: 1ex;
        }

        .heading .attribute {
            margin-top: 1ex;
            margin-bottom: 0;
        }

        .heading .description {
            margin-top: 4ex;
            margin-bottom: 6ex;
        }

        /* -- css div popup ------------------------------------------------------------------------ */
        a.popup_link {
        }

        a.popup_link:hover {
            color: red;
        }

        .popup_window {
            display: none;
            position: relative;
            left: 0px;
            top: 0px;
            /*border: solid #627173 1px; */
            padding: 10px;
            background-color: #E6E6D6;
            font-family: "Lucida Console", "Courier New", Courier, monospace;
            text-align: left;
            font-size: 8pt;
            width: 500px;
        }

        }
        /* -- report ------------------------------------------------------------------------ */
        #show_detail_line {
            margin-top: 3ex;
            margin-bottom: 1ex;
        }

        #result_table {
            width: 80%;
            border-collapse: collapse;
            border: 1px solid #777;
        }

        #header_row {
            font-weight: bold;
            color: white;
            background-color: #777;
        }

        #result_table td {
            border: 1px solid #777;
            padding: 2px;
        }

        #total_row {
            font-weight: bold;
        }

        .passClass {
            background-color: #6c6;
        }

        .failClass {
            background-color: #c60;
        }

        .errorClass {
            background-color: #c00;
        }

        .passCase {
            color: #6c6;
        }

        .failCase {
            color: #c60;
            font-weight: bold;
        }

        .errorCase {
            color: #c00;
            font-weight: bold;
        }

        .hiddenRow {
            display: none;
        }

        .testcase {
            margin-left: 2em;
        }


        /* -- ending ---------------------------------------------------------------------- */
        #ending {
        }
    </style>
</head>
<body>
<script language="javascript" type="text/javascript"><!--
output_list = Array();

/* level - 0:Summary; 1:Failed; 2:All */
function showCase(level) {
    trs = document.getElementsByTagName("tr");
    for (var i = 0; i < trs.length; i++) {
        tr = trs[i];
        id = tr.id;
        if (id.substr(0, 2) == 'ft') {
            if (level < 1) {
                tr.className = 'hiddenRow';
            } else {
                tr.className = '';
            }
        }
        if (id.substr(0, 2) == 'pt') {
            if (level > 1) {
                tr.className = '';
            } else {
                tr.className = 'hiddenRow';
            }
        }
    }
}


function showClassDetail(cid, count) {
    var id_list = Array(count);
    var toHide = 1;
    for (var i = 0; i < count; i++) {
        tid0 = 't' + cid.substr(1) + '.' + (i + 1);
        tid = 'f' + tid0;
        tr = document.getElementById(tid);
        if (!tr) {
            tid = 'p' + tid0;
            tr = document.getElementById(tid);
        }
        id_list[i] = tid;
        if (tr.className) {
            toHide = 0;
        }
    }
    for (var i = 0; i < count; i++) {
        tid = id_list[i];
        if (toHide) {
            document.getElementById('div_' + tid).style.display = 'none'
            document.getElementById(tid).className = 'hiddenRow';
        } else {
            document.getElementById(tid).className = '';
        }
    }
}


function showTestDetail(div_id) {
    var details_div = document.getElementById(div_id)
    var displayState = details_div.style.display
    // alert(displayState)
    if (displayState != 'block') {
        displayState = 'block'
        details_div.style.display = 'block'
    } else {
        details_div.style.display = 'none'
    }
}


function html_escape(s) {
    s = s.replace(/&/g, '&amp;');
    s = s.replace(/</g, '&lt;');
    s = s.replace(/>/g, '&gt;');
    return s;
}

/* obsoleted by detail in <div>
function showOutput(id, name) {
    var w = window.open("", //url
                    name,
                    "resizable,scrollbars,status,width=800,height=450");
    d = w.document;
    d.write("<pre>");
    d.write(html_escape(output_list[id]));
    d.write("\n");
    d.write("<a href='javascript:window.close()'>close</a>\n");
    d.write("</pre>\n");
    d.close();
}
*/
--></script>

<div class='heading'>
    <h1>
        {% if request_statu!='email' %}
            test result
        {% else %}
            接口自动化测试报告
        {% endif %}
    </h1>
    <p class='attribute'><strong>开始时间:</strong> {{ time }}</p>
    <p class='attribute'><strong>耗时:</strong>{{ taken_time }}</p>
    <p class='attribute'><strong>运行方式:</strong>定时任务自动触发</p>
    <p class='attribute'><strong>运行结果:</strong>成功:{{ success }}失败:{{ fail }}</p>
    {% if  job_result!='NULL' %}
        <p class='attribute'><strong>job_result:</strong>{{ job_result }}</p>
    {% endif %}
    <p class='description' name="result_url">结果地址:{{ result_url }}</p>
</div>


<h3>通过率柱状图</h3>
{% if request_statu!='email' %}
    <img src={{ pic_url }}    width="50%" height="350px" class="img-responsive" alt="Cinque Terre"
         id="zhuzhuangtu_today">
{% else %}
    <img src="cid:image1" width="50%" height="350px" class="img-responsive" alt="Cinque Terre" id="zhuzhuangtu_today">
{% endif %}
<p id='show_detail_line'>运行详情
    <a href='javascript:showCase(0)' class="summary">Summary</a>
    <!--<a href='javascript:showCase(1)'  class="all_fail">Failed</a>-->
    <!--<a href='javascript:showCase(2)'class="all_show">All</a>-->
</p>
{% for k in z %}
    <table id='result_table'>
        <colgroup>
            <col align='left'/>
            <col align='right'/>
            <col align='right'/>
            <col align='right'/>
            <col align='right'/>
            {% if  request_statu!='email' %}
                <col align='right'/>
            {% endif %}
        </colgroup>
        {% if  request_statu!='email' %}
            <tr name="top_name" style="font-size:20px;">
                <th colspan="6">{{ z[k]['all_name']['git_beizhu']+'：'+z[k]['all_name']['all_name'][0]+'：'+z[k]['all_name']['all_name'][1] }}</th>
            </tr>
        {% else %}
            <tr name="top_name" style="font-size:20px;">
                <th colspan="5">{{ z[k]['all_name']['git_beizhu']+'：'+z[k]['all_name']['all_name'][0]+'：'+z[k]['all_name']['all_name'][1] }}</th>
            </tr>
        {% endif %}
        <tr id='header_row'>
            <td>Test Group/Test case</td>
            <td>Count</td>
            <td>Pass</td>
            <td>Fail</td>
            <td>Error</td>
            {% if  request_statu!='email' %}
                <td>View</td>
            {% endif %}
        </tr>
        <!--字典形式，第一个key为接口名字，第二个key为-->
        {% for i in z[k]['all'] %}
            <tr class={{ i[1] }} name="title" id={{ i[0] }}>
                <td>{{ i[0] }}</td>
                <td>{{ i[2][0] }}</td>
                <td>{{ i[2][1] }}</td>
                <td>{{ i[2][2] }}</td>
                <td>0</td>
                {% if  request_statu!='email' %}
                    <td><a href="javascript:showClassDetail('c1',2)" class="detail">Detail</a></td>
                {% endif %}
            </tr>
            {% if request_statu!='email' %}
                <div class="test_case_all">
                    {% for k in i[-1] %}
                        <tr id='ft1.1' class='none' name={{ i[0] }}  style="display:none;">
                            <td class={{ k[0] }}>
                                <div class='testcase'>第{{ k[1] }}行：{{ k[2] }}</div>
                            </td>
                            <td colspan='5' align='center'>
                                <!--css div popup start-->
                                <a class="popup_link" onfocus='this.blur();'>
                                    {{ k[0] }}</a>
                                <div id='div_ft1.1' class="popup_window" name={{ i[0] }}>
                                    <div style='text-align: right; color:red;cursor:pointer'>
                                    </div>
                                    <pre>
            请求地址:
             {{ k[6] }}
            </pre>
                                                                 <pre>
            响应时间:{{ k[8] }}秒
            </pre>
                                    <pre>
            请求参数:
            {{ k[5] }}
            </pre>
                                    <pre>
            断言:
            {{ k[3] }}
        </pre>
                                    {% if k[7].strip()!='{}' %}
                                        <pre>
            输出头
            {{ k[7] }}
            </pre>
                                    {% endif %}
                                    <pre>
            输出结果
            {{ k[4] }}
            </pre>
                                </div>
                                <!--css div popup end-->
                            </td>
                        </tr>
                    {% endfor %}
                </div>
            {% endif %}
        {% endfor %}
        <tr id='total_row'>
            <td>Total</td>
            <td>{{ z[k]['count'] }}</td>
            <td>{{ z[k]['success'] }}</td>
            <td>{{ z[k]['fail'] }}</td>
            <td>0</td>
            {% if request_statu!='email' %}
                <td></td>
            {% endif %}
        </tr>
    </table>
    <br/>
    <br/>
{% endfor %}
<div id='ending'>&nbsp;</div>
<script src="{{ url_for('static', filename='jquery-1.8.0.js') }}"></script>
<script src="{{ url_for('static', filename='hualala/vendor/jquery/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='hualala/vendor/bootstrap/js/bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='layer-v3.0/layer/layer.js') }}"></script>
<script type=text/javascript>
    var $SCRIPT_ROOT = {{request.script_root|tojson|safe}};
</script>
<script type=text/javascript>
    function showTestDetail(div_id) {
        var details_div = document.getElementById(div_id)
        var displayState = details_div.style.display
        // alert(displayState)
        if (displayState != 'block') {
            displayState = 'block'
            details_div.style.display = 'block'
        } else {
            details_div.style.display = 'none'
        }
    }


    $(document).ready(function () {


            //将用例全部隐藏
            $('.detail').each(function (i, k) {

                var a = $(this).parent().parent().attr("id");


                $('tr[id*="ft1."][name="' + a + '"]').hide()


            })


            var count = 0;
            var pass = 0;
            var fail = 0;
            $('tr[name="title"]').each(function (i, k) {


                var i = parseInt($(this).find('td').eq(1).html());
                count = count + i;
                var i = parseInt($(this).find('td').eq(2).html());
                pass = i + pass;
                var i = parseInt($(this).find('td').eq(3).html());
                fail = i + fail
            })


            $('.detail').each(function (i, k) {

                $(this).click(function () {

                    var a = $(this).parent().parent().attr("id");
                    if ($('tr[id*="ft1."][name="' + a + '"]').is(":hidden")) {
                        $('tr[id*="ft1."][name="' + a + '"]').show()
                    } else {
                        $('tr[id*="ft1."][name="' + a + '"]').hide()
                    }


                })

            })


            $('.popup_link').each(
                function (i, k) {

                    $(this).attr('href', "javascript:showTestDetail('div_ft1." + String(i) + "')");

                }
            )


            var z = $('tr[id*="ft1."]');
            $('a[name="11"]').each(function (i, k) {
                    $(this).click(function () {
                            $(this).parent().hide()
                        }
                    )
                }
            )
            $.each(z, function (i, z) {
                    $(this).attr('id', 'ft1.' + String(i))
                }
            )
            $('div[id*="div_ft1."]').each(function (i, k) {
                    $(this).attr("id", "div_ft1." + String(i))
                }
            )
        }
    )
    //点击概要，隐藏所有详情
    $('.summary').click(function () {
            $('.hiddenRow').hide()
        }
    )
    <!--$('#zhuzhuangtu_today').attr('src','')-->
    <!--$('#zhuzhuangtu_today').attr('src','/pic_yewu_email/'+'yewu_today'+Date.parse(new Date()).toString())-->
</script>
</body>
</html>
